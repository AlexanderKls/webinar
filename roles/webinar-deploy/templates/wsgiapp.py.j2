import random
import subprocess

def application(environ, start_response):

    ips = ['172.19.0.3', '172.19.0.4', '172.19.0.5']
    query = 'SELECT First.firstname, Last.lastname, @@HOSTNAME FROM First INNER JOIN Last ORDER BY RAND() LIMIT 1;'

    random_ip = random.choice(ips)

    try:
        one_result = [subprocess.check_output(f'mysql webinar -BN -u root -h {random_ip} -p37896AYBSl9nHFhLvGiL -e "{query}" 2>&1 | grep -v "Using a password"', shell=True)]
    except:
        one_result = f'Could\'nt connect to the mysql server: {random_ip}'

    query_result = str(one_result).replace('\\t', ' ')

    format_string = str(f'{query_result.split()[0]} {query_result.split()[1]} from {query_result.split()[2]}')

    one_object = (str(format_string)[3:-4] + '\n').encode('ascii')

    status = '200 OK'
    headers = [('Content-type', 'text/plain')]
    start_response(status, headers)
    return [one_object]
